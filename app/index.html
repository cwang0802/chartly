<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Chartly</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1"> {{content-for "head"}}

    <link rel="stylesheet" href="{{rootURL}}assets/vendor.css">
    <link rel="stylesheet" href="{{rootURL}}assets/chartly.css"> {{content-for "head-footer"}}
</head>

<body>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript">
        var sizeFactor = 50000;
        var windowHeight = $(window).height();
        var windowWidth = $(window).width();
        var svgMargin = 10;
        var svgContainer = d3.select("body").append("svg")
            .attr("width", windowWidth - svgMargin)
            .attr("height", windowHeight - svgMargin)
            .attr("transform", "translate(" + svgMargin / 2 + "," + svgMargin / 2 + ")");

        $(window).resize(function() {
            windowHeight = $(window).height();
            windowWidth = $(window).width();
            svgContainer.attr("width", windowWidth - svgMargin).attr("height", windowHeight - svgMargin);
        })



        var colors = ["#FF5900", "#FF9A00", "#0D56A6", "#00A876"]
        var info = [];

        $.getJSON('assets/data/census.json', function(json) {
            $.each(json, function(index, value) {
                if (value.Geo_Code == '1' && 
                    value.Topic == 'Detailed mother tongue' 
                    && value.Total > 0 &&
                    value.Characteristic != 'Detailed mother tongue - Total population excluding institutional residents'
                    ) {
                    info.push(value);
                }
            })

            svgContainer.selectAll("circle")
                .data(info)
                .enter()
                .append("circle")
                .attr("r", function(d) {
                    return d.Total / sizeFactor;
                })
                .attr("cx", function() {
                    return Math.random() * (windowWidth - 2 * svgMargin) + svgMargin / 2
                })
                .attr("cy", function() {
                    return Math.random() * (windowHeight - 2 * svgMargin) + svgMargin / 2
                })
                .style("fill", function() {
                    return colors[Math.round(Math.random() * 3)]
                })
                .style("opacity", 0.5)
                .on("mouseover" , function() { 
                    d3.select(this).transition().attr('r', function(d) {  
                        svgContainer.append("text")
                            .attr("x", this.cx.animVal.value)
                            .attr("y", this.cy.animVal.value)
                            .text(d.Characteristic.trim() + ": " + d.Total)
                            .style("text-anchor", "middle")
                        return 1.2 * d.Total / sizeFactor;
                    });
                })
                .on("mouseout", function() { 
                    d3.select(this).transition().attr('r', function(d) { return d.Total / sizeFactor; });
                    d3.selectAll("text").remove();
                });
        })

        function myTransf() {
            d3.select("circle").transition().duration(500)
                .attr("cx", Math.random() * (windowWidth - 2 * svgMargin) + svgMargin / 2)
                .attr("cy", Math.random() * (windowHeight - 2 * svgMargin) + svgMargin / 2)
                .each("end", function() {
                    myTransf();
                })
        };
    </script>

    {{content-for "body"}}

    <script src="{{rootURL}}assets/vendor.js"></script>
    <script src="{{rootURL}}assets/chartly.js"></script>

    {{content-for "body-footer"}}
</body>

</html>